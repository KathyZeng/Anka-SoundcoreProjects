# 工作负载饱和度分析系统

一个基于 Streamlit 的团队工作负载分析和可视化系统,帮助团队管理者了解成员工作负载情况,优化资源分配。

## 功能特性

### 📊 数据管理
- Excel 文件上传和解析
- 历史数据记录和管理
- 数据预览和验证
- 多格式数据导出(CSV、Excel、JSON)

### 📈 智能分析
- 三周工作负载计算(本周、下周、下下周)
- 负载变化率追踪
- 超负荷预警
- 团队状态分布分析

### 📉 趋势洞察
- 历史数据对比
- 多期趋势分析
- 团队负载变化追踪
- 可视化图表展示

### ⚙️ 灵活配置
- 可调整的标准工时
- 自定义饱和度阈值
- 其他事务工时配置
- 主责成员管理
- 配置导入导出

## 快速开始

### 环境要求

- Python 3.8 或更高版本
- pip 包管理器

### 安装步骤

1. 克隆或下载项目到本地

2. 安装依赖包:
```bash
pip3 install -r requirements.txt
```

如果安装速度慢,可以使用清华镜像:
```bash
pip3 install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple
```

3. 运行应用:
```bash
streamlit run app.py
```

4. 浏览器会自动打开应用页面(默认地址: http://localhost:8501)

## 使用指南

### 1. 数据上传

在"数据上传"页面:
1. 点击"选择Excel文件"上传工作负载数据
2. 选择基准日期(默认为今天)
3. (可选) 设置主责成员
4. 点击"开始处理"按钮

**Excel文件格式要求:**
- Sheet名称: "预估工时"
- 第一列: 成员名称
- 其他列: 日期(格式: YYYY-MM-DD),值为工时(小时)

示例:
```
| 成员   | 2025-11-17 | 2025-11-18 | 2025-11-19 |
|--------|-----------|-----------|-----------|
| 张三   | 8         | 8         | 0         |
| 李四   | 8         | 8         | 8         |
```

**主责成员设置:**
- 主责成员需要额外时间进行项目对接,系统会自动增加主责事务工时
- 可在配置管理页面设置默认主责成员
- 也可在数据上传时动态选择主责成员

### 2. 数据预览

在"数据预览"页面:
- 查看处理后的数据
- 使用筛选功能查找特定成员或状态
- 检查数据计算是否正确
- 导出筛选后的数据

### 3. 负载分析

在"负载分析"页面:
- 查看三周工作负载分布图表
- 分析团队状态变化
- 获取工作负载建议
- 导出分析报告

### 4. 趋势对比

在"趋势对比"页面:
- 选择多个历史数据进行对比
- 查看负载变化趋势
- 分析团队状态演变
- 导出对比报告

### 5. 配置管理

在"配置管理"页面:
- 调整标准工时设置
- 修改饱和度阈值
- 配置其他事务工时
- 管理主责成员列表
- 导出和导入配置

## 状态说明

系统将团队成员分为四种负载状态:

- 🔴 **超负荷**: 饱和度 > 110% (默认)
  - 工作量过大,需要调整任务分配

- 🟢 **正常**: 饱和度 90% - 110% (默认)
  - 工作量适中,状态良好

- 🔵 **不饱和**: 饱和度 < 90% (默认)
  - 工作量不足,可以增加任务

- ⚪ **空闲**: 饱和度 = 0%
  - 无工作任务安排

阈值可以在"配置管理"页面自定义调整。

## 项目结构

```
Workload/
├── app.py                  # 主应用入口
├── config.yaml            # 配置文件
├── requirements.txt       # 依赖包列表
├── README.md             # 项目文档
├── core/                 # 核心业务逻辑
│   ├── data_processor.py  # 数据处理模块
│   ├── storage.py        # 文件存储管理
│   └── visualizer.py     # 可视化模块
├── pages/                # Streamlit页面
│   ├── 1_📊_数据上传.py
│   ├── 2_🔍_数据预览.py
│   ├── 3_📈_负载分析.py
│   ├── 4_📉_趋势对比.py
│   └── 5_⚙️_配置管理.py
├── utils/                # 工具模块
│   ├── validators.py     # 数据验证
│   └── formatters.py     # 格式化工具
└── data/                 # 数据目录
    ├── uploads/          # 上传的文件
    ├── processed/        # 处理后的数据
    └── reports/          # 生成的报告
```

## 配置说明

### config.yaml 配置文件

```yaml
# 标准工时(小时/周)
standard_hours_per_week: 40

# 其他事务配置
other_tasks:
  enabled: true
  weekly_minutes_per_person: 92  # 每人每周其他事务时间(分钟)

# 主责事务配置
primary_responsibility:
  enabled: true
  weekly_minutes_per_primary: 50  # 主责每周额外事务时间(分钟)
  members: []  # 主责成员列表,如: ["张三", "李四"]

# 饱和度阈值
saturation_thresholds:
  under_saturated_max: 90     # 不饱和上限(%)
  normal_min: 90              # 正常下限(%)
  normal_max: 110             # 正常上限(%)
  over_saturated_min: 110     # 超负荷下限(%)
```

### 主责事务工时说明

**功能说明:**
- 主责成员需要额外时间进行项目对接、协调等工作
- 系统会自动为主责成员增加主责事务工时(默认50分钟/周)
- 主责事务工时会计入饱和度计算

**配置方式:**

1. **配置文件配置(推荐固定主责)**
   ```yaml
   primary_responsibility:
     enabled: true
     weekly_minutes_per_primary: 50
     members:
       - 张三
       - 李四
   ```

2. **配置管理页面(可视化配置)**
   - 进入"配置管理"页面
   - 启用主责事务工时
   - 在文本框中输入成员名(每行一个)
   - 保存配置

3. **数据上传时动态选择(灵活调整)**
   - 上传文件后勾选"自定义主责成员"
   - 从下拉列表选择主责成员
   - 会覆盖配置文件的默认设置

**工时计算:**
- 非主责成员: 项目工时 + 其他事务工时
- 主责成员: 项目工时 + 其他事务工时 + 主责事务工时(默认50分钟/周)

**示例:**
假设项目工时40小时/周,其他事务1.53小时/周,主责事务0.83小时/周
- 非主责成员: 40 + 1.53 = 41.53小时 (饱和度103.8%)
- 主责成员: 40 + 1.53 + 0.83 = 42.37小时 (饱和度105.9%)

## 常见问题

### Q: 为什么上传文件后提示格式错误?

A: 请确保:
1. Excel文件包含名为"预估工时"的工作表
2. 第一列为成员名称
3. 其他列为日期列,格式为 YYYY-MM-DD
4. 数据单元格为数字类型,表示工时(小时)

### Q: 如何修改标准工时?

A: 在"配置管理"页面可以修改标准工时。修改后保存配置,然后重新上传数据即可应用新配置。

### Q: 数据会保存在哪里?

A: 所有数据保存在项目的 `data/` 目录下:
- `uploads/`: 上传的原始Excel文件
- `processed/`: 处理后的JSON数据
- `reports/`: 生成的报告文件

### Q: 如何清理历史数据?

A: 在"趋势对比"页面点击"清理90天前的数据"按钮,会自动删除90天前的历史文件。

## 技术栈

- **Web框架**: Streamlit
- **数据处理**: Pandas, NumPy
- **可视化**: Plotly
- **配置管理**: PyYAML
- **Excel处理**: openpyxl

## 版本历史

### v2.0.0 (当前版本)
- 完全迁移到Web应用
- 新增数据预览页面
- 支持历史趋势对比
- 可配置的分析参数
- 多格式报告导出

### v1.0.0
- 命令行版本
- 基础负载分析
- HTML报告生成

## 许可证

本项目仅供内部使用。

## 支持与反馈

如有问题或建议,请联系开发团队。

---

**开发**: Workload Analysis System Team
**版本**: 2.0.0
**更新日期**: 2025-11-20
